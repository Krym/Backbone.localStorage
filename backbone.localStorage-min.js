/**
 * Backbone localStorage Adapter
 * Version 1.1.0
 *
 * https://github.com/jeromegn/Backbone.localStorage
 */(function(e,t){typeof define=="function"&&define.amd?define(["underscore","backbone"],function(n,r){return t(n||e._,r||e.Backbone)}):t(_,Backbone)})(this,function(e,t){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}return t.LocalStorage=window.Store=function(e,t){this.name=e,this.species=typeof t!="undefined"?t:""},e.extend(t.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},createList:function(e){this.localStorage().setItem(this.name+"#"+this.species,e.pluck("id"))},create:function(e){return e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.find(e)},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.find(e)},find:function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){var t=this.localStorage().getItem(this.name+"#"+this.species),n=t&&t.split(",")||[];return e(n).chain().map(function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e))},this).compact().value()},destroy:function(e){return e.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+e.id),e)},destroyList:function(){this.localStorage().setItem(this.name+"#"+this.species,"")},localStorage:function(){return localStorage},jsonData:function(e){return e&&JSON.parse(e)}}),t.LocalStorage.sync=window.Store.sync=t.localSync=function(e,n,r){var i=n.localStorage||n.collection.localStorage,s,o,u=$.Deferred&&$.Deferred();try{switch(e){case"read":s=n.id!=undefined?i.find(n):i.findAll();if(s&&s.constructor==Array&&s.length>0){var e=r.update?"update":"reset";n[e](s,r)}var a=r.success;r.success=function(e,t,n){t=t.objects?t.objects:t;if(e.models){var r=n.update?"update":"reset";e[r](t,n),i.createList(e),e.forEach(function(e){e.save()}),a&&a(e,t,n)}else{if(!e.set(t,n))return!1;e.save(),a&&a(e,t,n)}},t.ajaxSync(e,n,r);break;case"create":s=i.create(n);break;case"update":s=i.update(n);break;case"delete":s=i.destroy(n)}}catch(f){f.code===DOMException.QUOTA_EXCEEDED_ERR&&window.localStorage.length===0?o="Private browsing is unsupported":o=f.message}return s&&s.constructor==Object?(n.trigger("sync",n,s,r),r&&r.success&&(t.VERSION==="0.9.10"?r.success(n,s,r):r.success(s)),u&&u.resolve(s)):(o=o?o:"Record Not Found",n.trigger("error",n,o,r),r&&r.error&&(t.VERSION==="0.9.10"?r.error(n,o,r):r.error(o)),u&&u.reject(o)),r&&r.complete&&r.complete(s),u&&u.promise()},t.ajaxSync=t.sync,t.getSyncMethod=function(e,n){return e.localStorage||e.collection&&e.collection.localStorage?n.forceRemote?t.ajaxSync:t.localSync:t.ajaxSync},t.sync=function(e,n,r){return t.getSyncMethod(n,r).apply(this,[e,n,r])},t.LocalStorage});